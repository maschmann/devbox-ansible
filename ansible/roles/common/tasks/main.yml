- name: copy files
  copy: src=../files/{{item.path}} dest={{item.dest}} mode={{item.mode}} owner={{item.owner}} group={{item.group}}
  with_items:
    - { path: '.bashrc', dest: '/root/.bashrc', owner: root, group: root, mode: 600 }
    - { path: '.bashrc', dest: '/home/vagrant/.bashrc', owner: vagrant, group: vagrant, mode: 600 }

- name: add repositories
  apt_repository: repo="{{item}}"
  register: multiverse_installed
  update_cache: false  # We will do ourselfs afterwards
  when: ansible_distribution == 'Ubuntu'
  with_items:
    - 'deb http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}} multiverse'
    - 'deb-src http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}} multiverse'
    - 'deb http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}}-updates multiverse'
    - 'deb-src http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}}-updates multiverse'

- apt:
  update_cache: true
  when: multiverse_installed | changed

- name: Upgrade repository
  action: command apt-get -y dist-upgrade --force-yes

- name: install syspackages
  action: apt pkg={{item}} state=latest
  with_items:
    - molly-guard
    - logrotate
    - vim
    - curl
    - git
    - git-flow
    - git-ftp
    - strace
    - sysstat
    - build-essential
    - wget
    - bash-completion
    - ntp
    - ntpdate
    - unzip
    - bzip2
    - zip
    - samba
    - samba-common
    - smbclient
    - sendmail
    - sendmail-bin
    - python
    - python-pip
    - python-dev
    - python-software-properties
    - python-mysqldb